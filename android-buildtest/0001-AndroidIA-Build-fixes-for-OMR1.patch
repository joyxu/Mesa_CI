From 12eb40236c72a2537ddc1ff38937087ef54964f6 Mon Sep 17 00:00:00 2001
From: Chen Lin Z <lin.z.chen@intel.com>
Date: Thu, 21 Feb 2019 14:55:36 +0200
Subject: [PATCH 2/3] AndroidIA: Build fixes for OMR1.

Jira: None.
Test: Build passes.

Signed-off-by: Chen Lin Z <lin.z.chen@intel.com>
---
 Android.common.mk           | 13 +++++++++++--
 src/egl/Android.mk          |  8 +++++++-
 src/intel/Android.common.mk |  1 +
 src/intel/Android.vulkan.mk | 31 ++++++++++++++++++++++++++-----
 src/vulkan/Android.mk       |  7 +++++--
 5 files changed, 50 insertions(+), 10 deletions(-)

diff --git a/Android.common.mk b/Android.common.mk
index 60459d16eba..5a8277ada35 100644
--- a/Android.common.mk
+++ b/Android.common.mk
@@ -77,14 +77,23 @@ LOCAL_CFLAGS += \
 	-fvisibility=hidden \
 	-fno-math-errno \
 	-fno-trapping-math \
-	-Wno-sign-compare
+	-Wno-sign-compare \
+	-Wno-self-assign \
+	-Wno-constant-logical-operand \
+	-Wno-format \
+	-Wno-incompatible-pointer-types \
+	-Wno-enum-conversion
 
 LOCAL_CPPFLAGS += \
 	-D__STDC_CONSTANT_MACROS \
 	-D__STDC_FORMAT_MACROS \
 	-D__STDC_LIMIT_MACROS \
 	-Wno-error=non-virtual-dtor \
-	-Wno-non-virtual-dtor
+	-Wno-non-virtual-dtor	\
+	-Wno-delete-non-virtual-dtor \
+	-Wno-overloaded-virtual \
+	-Wno-missing-braces \
+	-Wno-deprecated-register
 
 # mesa requires at least c99 compiler
 LOCAL_CONLYFLAGS += \
diff --git a/src/egl/Android.mk b/src/egl/Android.mk
index d30aa5e415a..73b47b56ec7 100644
--- a/src/egl/Android.mk
+++ b/src/egl/Android.mk
@@ -45,7 +45,9 @@ LOCAL_CFLAGS := \
 LOCAL_C_INCLUDES := \
 	$(MESA_TOP)/include \
 	$(MESA_TOP)/src/egl/main \
-	$(MESA_TOP)/src/egl/drivers/dri2
+	$(MESA_TOP)/src/egl/drivers/dri2 \
+	frameworks/native/libs/nativewindow/include \
+	frameworks/native/libs/arect/include
 
 LOCAL_STATIC_LIBRARIES := \
 	libmesa_util \
@@ -83,6 +85,10 @@ ifneq ($(MESA_BUILD_GALLIUM),)
 LOCAL_REQUIRED_MODULES += gallium_dri
 endif
 
+ifeq ($(shell test $(PLATFORM_SDK_VERSION) -ge 27; echo $$?), 0)
+LOCAL_HEADER_LIBRARIES += libnativebase_headers
+endif
+
 LOCAL_MODULE := libGLES_mesa
 LOCAL_MODULE_RELATIVE_PATH := egl
 
diff --git a/src/intel/Android.common.mk b/src/intel/Android.common.mk
index faec6b3ea4e..07d99375aed 100644
--- a/src/intel/Android.common.mk
+++ b/src/intel/Android.common.mk
@@ -44,3 +44,4 @@ LOCAL_WHOLE_STATIC_LIBRARIES := libmesa_genxml
 
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
+LOCAL_HEADER_LIBRARIES += liblog_headers
diff --git a/src/intel/Android.vulkan.mk b/src/intel/Android.vulkan.mk
index 04c9d5b3e4e..731bb6657c9 100644
--- a/src/intel/Android.vulkan.mk
+++ b/src/intel/Android.vulkan.mk
@@ -38,7 +38,10 @@ VULKAN_COMMON_INCLUDES := \
 	$(MESA_TOP)/src/intel \
 	$(MESA_TOP)/src/intel/vulkan \
 	$(MESA_TOP)/src/compiler \
-	frameworks/native/vulkan/include
+	frameworks/native/vulkan/include \
+	frameworks/native/libs/nativebase/include \
+	frameworks/native/libs/nativewindow/include \
+	frameworks/native/libs/arect/include
 
 # libmesa_anv_entrypoints with header and dummy.c
 #
@@ -74,6 +77,8 @@ LOCAL_EXPORT_C_INCLUDE_DIRS := \
 
 LOCAL_SHARED_LIBRARIES := libdrm
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -107,6 +112,8 @@ LOCAL_WHOLE_STATIC_LIBRARIES := libmesa_anv_entrypoints libmesa_genxml
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES)
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -120,13 +127,15 @@ LOCAL_MODULE_CLASS := STATIC_LIBRARIES
 
 LOCAL_SRC_FILES := $(VULKAN_GEN75_FILES)
 LOCAL_CFLAGS := -DGEN_VERSIONx10=75
-
+LOCAL_HEADER_LIBRARIES += libcutils_headers libsystem_headers
 LOCAL_C_INCLUDES := $(ANV_INCLUDES)
 
 LOCAL_WHOLE_STATIC_LIBRARIES := libmesa_anv_entrypoints libmesa_genxml
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES)
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -140,13 +149,15 @@ LOCAL_MODULE_CLASS := STATIC_LIBRARIES
 
 LOCAL_SRC_FILES := $(VULKAN_GEN8_FILES)
 LOCAL_CFLAGS := -DGEN_VERSIONx10=80
-
+LOCAL_HEADER_LIBRARIES += libcutils_headers libsystem_headers
 LOCAL_C_INCLUDES := $(ANV_INCLUDES)
 
 LOCAL_WHOLE_STATIC_LIBRARIES := libmesa_anv_entrypoints libmesa_genxml
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES)
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -160,13 +171,15 @@ LOCAL_MODULE_CLASS := STATIC_LIBRARIES
 
 LOCAL_SRC_FILES := $(VULKAN_GEN9_FILES)
 LOCAL_CFLAGS := -DGEN_VERSIONx10=90
-
+LOCAL_HEADER_LIBRARIES += libcutils_headers libsystem_headers
 LOCAL_C_INCLUDES := $(ANV_INCLUDES)
 
 LOCAL_WHOLE_STATIC_LIBRARIES := libmesa_anv_entrypoints libmesa_genxml
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES)
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -180,13 +193,15 @@ LOCAL_MODULE_CLASS := STATIC_LIBRARIES
 
 LOCAL_SRC_FILES := $(VULKAN_GEN10_FILES)
 LOCAL_CFLAGS := -DGEN_VERSIONx10=100
-
+LOCAL_HEADER_LIBRARIES += libcutils_headers libsystem_headers
 LOCAL_C_INCLUDES := $(ANV_INCLUDES)
 
 LOCAL_WHOLE_STATIC_LIBRARIES := libmesa_anv_entrypoints libmesa_genxml
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES)
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -207,6 +222,8 @@ LOCAL_WHOLE_STATIC_LIBRARIES := libmesa_anv_entrypoints libmesa_genxml
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES)
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -261,6 +278,8 @@ $(intermediates)/vulkan/anv_extensions.h:
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES)
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_STATIC_LIBRARY)
 
@@ -310,5 +329,7 @@ LOCAL_WHOLE_STATIC_LIBRARIES := \
 
 LOCAL_SHARED_LIBRARIES := $(ANV_SHARED_LIBRARIES) libexpat libz libsync liblog
 
+LOCAL_HEADER_LIBRARIES += libcutils_headers libhardware_headers
+
 include $(MESA_COMMON_MK)
 include $(BUILD_SHARED_LIBRARY)
diff --git a/src/vulkan/Android.mk b/src/vulkan/Android.mk
index 6253f1c3be9..730d036d18c 100644
--- a/src/vulkan/Android.mk
+++ b/src/vulkan/Android.mk
@@ -32,12 +32,15 @@ include $(LOCAL_PATH)/Makefile.sources
 include $(CLEAR_VARS)
 LOCAL_MODULE := libmesa_vulkan_util
 LOCAL_MODULE_CLASS := STATIC_LIBRARIES
-
+LOCAL_HEADER_LIBRARIES += libcutils_headers libsystem_headers
 intermediates := $(call local-generated-sources-dir)
 
 LOCAL_C_INCLUDES := \
 	$(MESA_TOP)/include/vulkan \
-	$(MESA_TOP)/src/vulkan/util
+	$(MESA_TOP)/src/vulkan/util \
+	frameworks/native/libs/nativebase/include \
+	frameworks/native/libs/nativewindow/include \
+	frameworks/native/libs/arect/include
 
 LOCAL_GENERATED_SOURCES := $(addprefix $(intermediates)/, \
 	$(VULKAN_UTIL_GENERATED_FILES))
-- 
2.21.0

